<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Plotly Test</title>
  <script src="plotly-latest.min.js"></script>
</head>
<body>

<div id="graph" style="width:900px;height:600px;"></div>

<button type="button" onclick="pause()">Pause</button>

<script>
  // assumed time span is one minute
  const arrayLength = 20;// 60 * 1000 / 100; // 60 seconds * 1000 milliseconds / 100 milliseconds

  let isPaused = false;

  function pause() {
    isPaused = !isPaused;
  }

  function rand() {
    return Math.random();
  }

  function updateArray(arr, scale) {
    arr.push(rand() * scale);
    if (arr.length > arrayLength) {
      arr.splice(0, 1);
    }
  }

  let graphNode = document.getElementById('graph');


  let xValues = [];
  let yValues = [];
  for (let i = 0; i < arrayLength; i++) {
    xValues[i] = arrayLength - i;
    yValues[i] = 0;
  }

  const colorMassFlowRate = '#0000ff';

  const scaleMassFlowRate = 1.0;

  let massFlowRate = {
    x: xValues.slice(0),
    y: yValues.slice(0),
    connectgaps: true,
    mode: 'lines+markers',
    name: 'Mass flow rate',
    marker: {
      color: colorMassFlowRate,
      size: 8
    },
    line: {
      color: colorMassFlowRate,
      width: 3,
      shape: 'linear',
      dash: 'solid',
      simplify: false // prevent artifacts while animating 
    }
  };

  let data = [
    massFlowRate
  ];

  let layout = {
    title: 'Some title',
    xaxis: {
      title: 'Time passed (seconds)',
      autorange: 'reversed'
      //type: 'date',
      //tickvals: [0, 100, 200, 300, 400, 500, 600],
      //ticktext: ['0', '10', '20', '30', '40', '50', '60']
      /*
      showgrid: true,
      zeroline: false,
      range: getXAxisTimeRange(now),
      autorange: true,
      showline: true,
      showticklabels: true,
      linecolor: 'rgb(204,204,204)',
      linewidth: 2,
      autotick: false,
      ticks: 'outside',
      tickcolor: 'rgb(204,204,204)',
      tickwidth: 2,
      ticklen: 5,
      tickfont: {
        family: 'Arial',
        size: 12,
        color: 'rgb(82, 82, 82)'
      }
      */
    }
    ,
    yaxis: {
      title: 'Mass flow rate',
      range: [0, 1.0 * scaleMassFlowRate],
      fixedrange: true, // do not zoom y-axis,
      titlefont: {color: colorMassFlowRate},
      tickfont: {color: colorMassFlowRate}
    },
  };

  Plotly.newPlot(graphNode,
    data,
    layout,
    {displaylogo: false, modeBarButtonsToRemove: ['select2d', 'lasso2d', 'toggleSpikelines']});

  let interval = setInterval(function () {
    if (isPaused) {
      return;
    }
    // fetch data via REST API
    updateArray(yValues, scaleMassFlowRate); // TODO real value

    Plotly.animate(graphNode, {
      data: [{y: yValues.slice(0)}],
      traces: [0],
      layout: {}
    }, {
      transition: {
        duration: 500,
        easing: 'cubic-in-out'
      },
      frame: {
        duration: 500
      }
    })

  }, 1000);
</script>

</body>
</html>
